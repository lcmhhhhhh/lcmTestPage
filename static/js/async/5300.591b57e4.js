"use strict";(self.webpackChunklcm_test_page=self.webpackChunklcm_test_page||[]).push([["5300"],{5851:function(e,n,d){d.r(n),d.d(n,{default:()=>h});var l=d(5893),s=d(65);function c(e){let n=Object.assign({h1:"h1",code:"code",a:"a",p:"p",h2:"h2",h3:"h3",ul:"ul",li:"li",pre:"pre",strong:"strong",ol:"ol"},(0,s.ah)(),e.components);return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.h1,{id:"shell-工具-run_shell_command",children:["Shell 工具 (",(0,l.jsx)(n.code,{children:"run_shell_command"}),")",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#shell-工具-run_shell_command",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:["本文档描述了 VeCLI 的 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 工具。"]}),"\n",(0,l.jsxs)(n.h2,{id:"描述",children:["描述",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#描述",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:["使用 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 与底层系统交互、运行脚本或执行命令行操作。",(0,l.jsx)(n.code,{children:"run_shell_command"})," 执行给定的 shell 命令。在 Windows 上，该命令将使用 ",(0,l.jsx)(n.code,{children:"cmd.exe /c"})," 执行。在其他平台上，该命令将使用 ",(0,l.jsx)(n.code,{children:"bash -c"})," 执行。"]}),"\n",(0,l.jsxs)(n.h3,{id:"参数",children:["参数",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#参数",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"run_shell_command"})," 接受以下参数："]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"command"})," (字符串, 必需): 要执行的确切 shell 命令。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"description"})," (字符串, 可选): 命令目的的简要描述，将显示给用户。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"directory"})," (字符串, 可选): 执行命令的目录（相对于项目根目录）。如果未提供，则命令在项目根目录中运行。"]}),"\n"]}),"\n",(0,l.jsxs)(n.h2,{id:"如何在-vecli-中使用-run_shell_command",children:["如何在 VeCLI 中使用 ",(0,l.jsx)(n.code,{children:"run_shell_command"}),(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#如何在-vecli-中使用-run_shell_command",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:["使用 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 时，该命令作为子进程执行。",(0,l.jsx)(n.code,{children:"run_shell_command"})," 可以使用 ",(0,l.jsx)(n.code,{children:"&"})," 启动后台进程。该工具返回有关执行的详细信息，包括："]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Command"}),": 执行的命令。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Directory"}),": 运行命令的目录。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Stdout"}),": 标准输出流的输出。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Stderr"}),": 标准错误流的输出。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Error"}),": 子进程报告的任何错误消息。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Exit Code"}),": 命令的退出代码。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Signal"}),": 如果命令被信号终止，则为信号编号。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Background PIDs"}),": 启动的任何后台进程的 PID 列表。"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"用法:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'run_shell_command(command="Your commands.", description="Your description of the command.", directory="Your execution directory.")\n'})}),"\n",(0,l.jsxs)(n.h2,{id:"run_shell_command-示例",children:[(0,l.jsx)(n.code,{children:"run_shell_command"})," 示例",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#run_shell_command-示例",children:"#"})]}),"\n",(0,l.jsx)(n.p,{children:"列出当前目录中的文件："}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'run_shell_command(command="ls -la")\n'})}),"\n",(0,l.jsx)(n.p,{children:"在特定目录中运行脚本："}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'run_shell_command(command="./my_script.sh", directory="scripts", description="Run my custom script")\n'})}),"\n",(0,l.jsx)(n.p,{children:"启动后台服务器："}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:'run_shell_command(command="npm run dev &", description="Start development server in background")\n'})}),"\n",(0,l.jsxs)(n.h2,{id:"重要提示",children:["重要提示",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#重要提示",children:"#"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"安全性:"})," 执行命令时要小心，特别是那些由用户输入构建的命令，以防止安全漏洞。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"交互式命令:"})," 避免需要交互式用户输入的命令，因为这可能导致工具挂起。如果可用，请使用非交互式标志（例如，",(0,l.jsx)(n.code,{children:"npm init -y"}),"）。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"错误处理:"})," 检查 ",(0,l.jsx)(n.code,{children:"Stderr"}),"、",(0,l.jsx)(n.code,{children:"Error"})," 和 ",(0,l.jsx)(n.code,{children:"Exit Code"})," 字段以确定命令是否成功执行。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"后台进程:"})," 当使用 ",(0,l.jsx)(n.code,{children:"&"})," 在后台运行命令时，工具将立即返回，进程将在后台继续运行。",(0,l.jsx)(n.code,{children:"Background PIDs"})," 字段将包含后台进程的进程 ID。"]}),"\n"]}),"\n",(0,l.jsxs)(n.h2,{id:"环境变量",children:["环境变量",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#环境变量",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:["当 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 执行命令时，它会在子进程的环境中设置 ",(0,l.jsx)(n.code,{children:"GEMINI_CLI=1"})," 环境变量。这允许脚本或工具检测它们是否在 VeCLI 内运行。"]}),"\n",(0,l.jsxs)(n.h2,{id:"命令限制",children:["命令限制",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#命令限制",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:["您可以通过在配置文件中使用 ",(0,l.jsx)(n.code,{children:"tools.core"})," 和 ",(0,l.jsx)(n.code,{children:"tools.exclude"})," 设置来限制 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 工具可以执行的命令。"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"tools.core"}),": 要将 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 限制为特定的一组命令，请在 ",(0,l.jsx)(n.code,{children:"tools"})," 类别下的 ",(0,l.jsx)(n.code,{children:"core"})," 列表中添加格式为 ",(0,l.jsx)(n.code,{children:"run_shell_command(<command>)"})," 的条目。例如，",(0,l.jsx)(n.code,{children:'"tools": {"core": ["run_shell_command(git)"]}'})," 将只允许 ",(0,l.jsx)(n.code,{children:"git"})," 命令。包含通用的 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 作为通配符，允许任何未明确阻止的命令。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"tools.exclude"}),": 要阻止特定命令，请在 ",(0,l.jsx)(n.code,{children:"tools"})," 类别下的 ",(0,l.jsx)(n.code,{children:"exclude"})," 列表中添加格式为 ",(0,l.jsx)(n.code,{children:"run_shell_command(<command>)"})," 的条目。例如，",(0,l.jsx)(n.code,{children:'"tools": {"exclude": ["run_shell_command(rm)"]}'})," 将阻止 ",(0,l.jsx)(n.code,{children:"rm"})," 命令。"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"验证逻辑旨在安全且灵活："}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"命令链接禁用"}),": 该工具会自动拆分用 ",(0,l.jsx)(n.code,{children:"&&"}),"、",(0,l.jsx)(n.code,{children:"||"})," 或 ",(0,l.jsx)(n.code,{children:";"})," 链接的命令，并分别验证每个部分。如果链中的任何部分被禁止，则整个命令将被阻止。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"前缀匹配"}),": 该工具使用前缀匹配。例如，如果您允许 ",(0,l.jsx)(n.code,{children:"git"}),"，则可以运行 ",(0,l.jsx)(n.code,{children:"git status"})," 或 ",(0,l.jsx)(n.code,{children:"git log"}),"。"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"阻止列表优先"}),": 始终首先检查 ",(0,l.jsx)(n.code,{children:"tools.exclude"})," 列表。如果命令与被阻止的前缀匹配，则将被拒绝，即使它也与 ",(0,l.jsx)(n.code,{children:"tools.core"})," 中允许的前缀匹配。"]}),"\n"]}),"\n",(0,l.jsxs)(n.h3,{id:"命令限制示例",children:["命令限制示例",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#命令限制示例",children:"#"})]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"仅允许特定命令前缀"})}),"\n",(0,l.jsxs)(n.p,{children:["要仅允许 ",(0,l.jsx)(n.code,{children:"git"})," 和 ",(0,l.jsx)(n.code,{children:"npm"})," 命令，并阻止所有其他命令："]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "tools": {\n    "core": ["run_shell_command(git)", "run_shell_command(npm)"]\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"git status"}),": 允许"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"npm install"}),": 允许"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ls -l"}),": 阻止"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"阻止特定命令前缀"})}),"\n",(0,l.jsxs)(n.p,{children:["要阻止 ",(0,l.jsx)(n.code,{children:"rm"})," 并允许所有其他命令："]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "tools": {\n    "core": ["run_shell_command"],\n    "exclude": ["run_shell_command(rm)"]\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"rm -rf /"}),": 阻止"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"git status"}),": 允许"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"npm install"}),": 允许"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"阻止列表优先"})}),"\n",(0,l.jsxs)(n.p,{children:["如果命令前缀同时在 ",(0,l.jsx)(n.code,{children:"tools.core"})," 和 ",(0,l.jsx)(n.code,{children:"tools.exclude"})," 中，则将被阻止。"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "tools": {\n    "core": ["run_shell_command(git)"],\n    "exclude": ["run_shell_command(git push)"]\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"git push origin main"}),": 阻止"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"git status"}),": 允许"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"阻止所有 shell 命令"})}),"\n",(0,l.jsxs)(n.p,{children:["要阻止所有 shell 命令，请将 ",(0,l.jsx)(n.code,{children:"run_shell_command"})," 通配符添加到 ",(0,l.jsx)(n.code,{children:"tools.exclude"}),"："]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",children:'{\n  "tools": {\n    "exclude": ["run_shell_command"]\n  }\n}\n'})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"ls -l"}),": 阻止"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"any other command"}),": 阻止"]}),"\n"]}),"\n",(0,l.jsxs)(n.h2,{id:"excludetools-的安全说明",children:[(0,l.jsx)(n.code,{children:"excludeTools"})," 的安全说明",(0,l.jsx)(n.a,{className:"header-anchor","aria-hidden":"true",href:"#excludetools-的安全说明",children:"#"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"run_shell_command"})," 的 ",(0,l.jsx)(n.code,{children:"excludeTools"})," 中的命令特定限制基于简单的字符串匹配，很容易被绕过。此功能",(0,l.jsx)(n.strong,{children:"不是安全机制"}),"，不应依赖它来安全地执行不受信任的代码。建议使用 ",(0,l.jsx)(n.code,{children:"coreTools"})," 明确选择可以执行的命令。"]})]})}function r(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{wrapper:n}=Object.assign({},(0,s.ah)(),e.components);return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}let h=r;r.__RSPRESS_PAGE_META={},r.__RSPRESS_PAGE_META["zh%2Ftools%2Fshell.md"]={toc:[{text:"描述",id:"描述",depth:2},{text:"参数",id:"参数",depth:3},{text:"如何在 VeCLI 中使用 `run_shell_command`",id:"如何在-vecli-中使用-run_shell_command",depth:2},{text:"`run_shell_command` 示例",id:"run_shell_command-示例",depth:2},{text:"重要提示",id:"重要提示",depth:2},{text:"环境变量",id:"环境变量",depth:2},{text:"命令限制",id:"命令限制",depth:2},{text:"命令限制示例",id:"命令限制示例",depth:3},{text:"`excludeTools` 的安全说明",id:"excludetools-的安全说明",depth:2}],title:"Shell 工具 (`run_shell_command`)",headingTitle:"Shell 工具 (`run_shell_command`)",frontmatter:{}}}}]);