# vecli 12306 MCP FaaS Deployment Practice
## Prerequisites
### Download vecli

```bash
npm i @volc-iaas-test01/vecli@latest -g
```

### Add Volcano Vefaas MCP

Log in to the Volcano MCP Marketplace, [login](https://www.volcengine.com/mcp-marketplace/detail?name=veFaaS%20MCP) and generate an account.

![img](/demo2-1.PNG)

Follow the instructions to configure MCP in settings

```bash
vi ~/.ve/settings.json

#Add Volcano Vefaas MCP server
"mcpServers": {
    "mcp_server_vefaas_function": {
      "httpUrl": "https://vefaas.mcp.volcbiz.com/mcp?xxxx"
    }
  }
```

Confirm that your MCP has been imported correctly

![img](/demo2-2.PNG)

## Local Build Requirements

### Create Requirement MD Document

Create a working directory

```bash
mkdir train_mcp
cd train_mcp
vi VE.md
```

Create sample

Build VE.md document

```markdown
# 12306 Ticket Query API MCP Tool Configuration (Based on Juhe API)

## Core Task
Based on Juhe's 12306 ticket query API, refer to `template.py` to encapsulate it as an MCP tool service, deploy the output to vefaas with the name `train_tickets_query`. Ensure the resulting MCP can be correctly identified and called.

## 12306 Ticket Query API Basic Information
- API URL: `https://apis.juhe.cn/fapigw/train/query`
- Request Method: `GET`
- API Key: `{api_key}` (built-in, no need for user input)
- Documentation Reference: [Juhe 12306 Ticket Query Interface](https://apis.juhe.cn/fapigw/train/query)
- curl Example: `curl -k -i "https://apis.juhe.cn/fapigw/train/query?key={api_key}&search_type=1&departure_station=Xi'an&arrival_station=Beijing&date=2025-09-10&filter=&enable_booking=&departure_time_range="`

## 12306 Ticket Query MCP Tool Definition
### Tool Name
`train_tickets_query`

### Function Description
Query train ticket information for specified date, departure station and arrival station, returning train number, time, seat type and ticket availability status.

### Parameter Specification
```json
{
  "name": "train_tickets_query",
  "description": "Query train ticket information for specified date, departure station and arrival station, returning train number, time, seat type and ticket availability status.",
  "inputSchema": {
    "type": "object",
    "properties": {
      "departure_station": {
        "type": "string",
        "description": "Departure city (e.g., Beijing, use city name not station name)"
      },
      "arrival_station": {
        "type": "string",
        "description": "Arrival city (e.g., Shanghai)"
      },
      "date": {
        "type": "string",
        "format": "YYYY-MM-DD",
        "description": "Departure date (e.g., 2024-10-01)"
      }
    },
    "required": ["departure_station", "arrival_station", "date"]
  }
}
```

### Result Verification
1. After deployment, check if it is started correctly
2. Create a gateway trigger for the service to ensure it can be correctly accessed and triggered
3. Ensure the MCP tool can be correctly identified and called
```

## Create Template Code

```python
#template.py
from mcp.server.fastmcp import FastMCP

mcp = FastMCP(port=8000, host="0.0.0.0")

@mcp.tool()
def sum(a: int, b: int) -> int:
    return a + b

if __name__ == "__main__":
    mcp.run(transport="streamable-http")
    
#requirements.txt
fastmcp==2.12.2
```

## Start Execution

```bash
# Start vecli
vecli

# Select model (deepseek-v3-1-250821)
/model

# Enter instruction
Please help me implement the requirements in the VE.md file, please communicate in Chinese throughout
```

![img](/demo2-3.png)

Select model

![img](/demo2-4.png)

Create MCP service

![img](/demo2-5.png)

Choose to always trust all tools of MCP

![img](/demo2-6.png)

Call tool to check runtime and create function

![img](/demo2-7.png)

Create code

![img](/demo2-8.png)

Publish function and check status

![img](/demo2-9.png)

Create gateway trigger

![img](/demo2-10.png)

![img](/demo2-11.png)

## Configure MCP Service

### Check Service Status

Ensure that the train_tickets_query service found on the FaaS platform is running correctly and the gateway is configured properly

![img](/demo2-12.png)

### Create MCP for vecli

Confirm that MCP has been added

![img](/demo2-13.png)

### Try MCP

![img](/demo2-14.png)

![img](/demo2-15.png)

Try adding to Trae

![img](/demo2-16.png)