# vecli 12306 mcp faas 部署实践
## 前置准备
### 下载vecli

```bash
npm i @volc-iaas-test01/vecli@latest -g
```

### 添加火山Vefaas MCP

登录火山mcp广场，[登录](https://www.volcengine.com/mcp-marketplace/detail?name=veFaaS%20MCP)并生成账号。

![img](/demo2-1.PNG)

按照指引将mcp配置到setting中

```bash
vi ~/.ve/settings.json

#新增火山Vefaas mcp server
"mcpServers": {
    "mcp_server_vefaas_function": {
      "httpUrl": "https://vefaas.mcp.volcbiz.com/mcp?xxxx"
    }
  }
```

确认自己的mcp已经被正确导入

![img](/demo2-2.PNG)

## 本地构建需求

### 创建需求md文档

创建工作目录

```bash
mkdir train_mcp
cd train_mcp
vi VE.md
```

创建样例

构建VE.md文档

```markdown
# 12306查票API的MCP工具配置（基于聚合数据API）

## 核心任务
基于聚合数据的12306查票API，参考`template.py`将其封装为一个MCP工具服务，将产物部署到vefaas，名称为`train_tickets_query`。产出的MCP要确保可以被正确的识别和调用。

## 12306查票API基础信息
- 接口地址：`https://apis.juhe.cn/fapigw/train/query`
- 请求方式：`GET`
- API密钥：`{api_key}`（已内置，无需用户输入）
- 文档参考：[聚合数据12306查票接口](https://apis.juhe.cn/fapigw/train/query)
- curl样例：`curl -k -i "https://apis.juhe.cn/fapigw/train/query?key={api_key}&search_type=1&departure_station=西安&arrival_station=北京&date=2025-09-10&filter=&enable_booking=&departure_time_range="`

## 12306查票MCP工具定义
### 工具名称
`train_tickets_query`

### 功能描述
查询指定日期、出发站和到达站的火车票信息，返回车次、时间、座位类型及余票状态。

### 参数规范
```json
{
  "name": "train_tickets_query",
  "description": "查询指定日期、出发站和到达站的火车票信息，返回车次、时间、座位类型及余票状态。",
  "inputSchema": {
    "type": "object",
    "properties": {
      "departure_station": {
        "type": "string",
        "description": "出发站城市（如：北京，需使用城市名而非车站名）"
      },
      "arrival_station": {
        "type": "string",
        "description": "到达站城市（如：上海）"
      },
      "date": {
        "type": "string",
        "format": "YYYY-MM-DD",
        "description": "出发日期（如：2024-10-01）"
      }
    },
    "required": ["departure_station", "arrival_station", "date"]
  }
}
```

### 结果校验
1. 部署完成后要检查是否正确被启动
2. 为服务创建网关触发器，保证其可以被正确的访问触发
3. 确保mcp工具可以被正确的识别和调用
```

## 创建模板代码

```python
#template.py
from mcp.server.fastmcp import FastMCP

mcp = FastMCP(port=8000, host="0.0.0.0")

@mcp.tool()
def sum(a: int, b: int) -> int:
    return a + b

if __name__ == "__main__":
    mcp.run(transport="streamable-http")
    
#requirements.txt
fastmcp==2.12.2
```

## 开始执行

```bash
# 启动vecli
vecli

# 选择模型 （ deepseek-v3-1-250821）
/model

# 输入指令
请帮我实现 VE.md 文件的需求,请全程使用中文交流
```

![img](/demo2-3.png)

选择model

![img](/demo2-4.png)

创建mcp服务

![img](/demo2-5.png)

选择始终信任mcp的所有工具

![img](/demo2-6.png)

调用工具检查运行时并创建函数

![img](/demo2-7.png)

创建代码

![img](/demo2-8.png)

发布函数并检查状态

![img](/demo2-9.png)

创建网关触发器

![img](/demo2-10.png)

![img](/demo2-11.png)

## 配置MCP服务

### 检查服务状态

确保faas平台找到的train_tickets_query服务，确认正确运行，网关被正确配置

![img](/demo2-12.png)

### 为vecli创建mcp

确认已经添加mcp

![img](/demo2-13.png)

### 尝试MCP

![img](/demo2-14.png)

![img](/demo2-15.png)

尝试添加到trae

![img](/demo2-16.png)