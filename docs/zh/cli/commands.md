# CLI 命令

VeCLI 支持多个内置命令来帮助您管理会话、自定义界面和控制其行为。这些命令以正斜杠（`/`）、at 符号（`@`）或感叹号（`!`）为前缀。

## 斜杠命令（`/`）

斜杠命令提供对 CLI 本身的元级别控制。

### 内置命令

- **`/bug`**
  - **描述：** 提交关于 VeCLI 的问题。默认情况下，问题会在 VeCLI 的 GitHub 存储库中提交。您在 `/bug` 后输入的字符串将成为所提交错误的标题。可以使用 `.ve/settings.json` 文件中的 `advanced.bugCommand` 设置修改默认的 `/bug` 行为。

- **`/chat`**
  - **描述：** 保存和恢复对话历史记录，用于交互式分支对话状态，或从后续会话中恢复先前状态。
  - **子命令：**
    - **`save`**
      - **描述：** 保存当前对话历史记录。您必须添加一个 `<tag>` 来标识对话状态。
      - **用法：** `/chat save <tag>`
      - **检查点位置详细信息：** 保存的聊天检查点的默认位置是：
        - Linux/macOS：`~/.ve/tmp/<project_hash>/`
        - Windows：`C:\Users\<YourUsername>\.ve\tmp\<project_hash>\`
        - 当您运行 `/chat list` 时，CLI 只扫描这些特定目录来查找可用的检查点。
        - **注意：** 这些检查点用于手动保存和恢复对话状态。有关在文件修改前创建的自动检查点，请参阅[检查点文档](../checkpointing.md)。
    - **`resume`**
      - **描述：** 从先前保存中恢复对话。
      - **用法：** `/chat resume <tag>`
    - **`list`**
      - **描述：** 列出可用于聊天状态恢复的标签。
    - **`delete`**
      - **描述：** 删除保存的对话检查点。
      - **用法：** `/chat delete <tag>`

- **`/clear`**
  - **描述：** 清除终端屏幕，包括 CLI 中的可见会话历史记录和回滚。底层会话数据（用于历史记录回调）可能会根据具体实现而保留，但视觉显示会被清除。
  - **键盘快捷键：** 随时按 **Ctrl+L** 执行清除操作。

- **`/compress`**
  - **描述：** 用摘要替换整个聊天上下文。这可以节省未来任务使用的令牌，同时保留已发生事件的高级摘要。

- **`/copy`**
  - **描述：** 将 VeCLI 产生的最后输出复制到剪贴板，便于共享或重用。
  - **注意：** 此命令需要安装特定于平台的剪贴板工具。
    - 在 Linux 上，需要 `xclip` 或 `xsel`。您通常可以使用系统的包管理器安装它们。
    - 在 macOS 上，需要 `pbcopy`，在 Windows 上，需要 `clip`。这些工具通常在各自的系统上预安装。

- **`/directory`**（或 **`/dir`**）
  - **描述：** 管理工作区目录以支持多目录。
  - **子命令：**
    - **`add`**：
      - **描述：** 向工作区添加目录。路径可以是绝对路径或相对于当前工作目录的路径。此外，还支持从主目录的引用。
      - **用法：** `/directory add <path1>,<path2>`
      - **注意：** 在限制性沙盒配置文件中禁用。如果您使用该配置文件，请在启动会话时使用 `--include-directories`。
    - **`show`**：
      - **描述：** 显示通过 `/directory add` 和 `--include-directories` 添加的所有目录。
      - **用法：** `/directory show`

- **`/editor`**
  - **描述：** 打开用于选择支持的编辑器的对话框。

- **`/extensions`**
  - **描述：** 列出当前 VeCLI 会话中的所有活动扩展。请参阅 [VeCLI 扩展](../extension.md)。

- **`/help`**（或 **`/?`**）
  - **描述：** 显示关于 VeCLI 的帮助信息，包括可用命令及其用法。

- **`/mcp`**
  - **描述：** 列出配置的模型上下文协议（MCP）服务器、其连接状态、服务器详细信息和可用工具。
  - **子命令：**
    - **`desc`** 或 **`descriptions`**：
      - **描述：** 显示 MCP 服务器和工具的详细描述。
    - **`nodesc`** 或 **`nodescriptions`**：
      - **描述：** 隐藏工具描述，仅显示工具名称。
    - **`schema`**：
      - **描述：** 显示工具配置参数的完整 JSON 架构。
  - **键盘快捷键：** 随时按 **Ctrl+T** 在显示和隐藏工具描述之间切换。

- **`/memory`**
  - **描述：** 管理 AI 的指令上下文（从 `VE.md` 文件加载的分层内存）。
  - **子命令：**
    - **`add`**：
      - **描述：** 将以下文本添加到 AI 的内存中。用法：`/memory add <要记住的文本>`
    - **`show`**：
      - **描述：** 显示从所有 `VE.md` 文件加载的当前分层内存的完整、连接内容。这让您可以检查提供给火山引擎模型的指令上下文。
    - **`refresh`**：
      - **描述：** 从配置位置（全局、项目/祖先和子目录）中找到的所有 `VE.md` 文件重新加载分层指令内存。此命令使用最新的 `VE.md` 内容更新模型。
    - **注意：** 有关 `VE.md` 文件如何贡献分层内存的更多详细信息，请参阅 [CLI 配置文档](./configuration.md#4-ve.md-files-hierarchical-instructional-context)。

- **`/restore`**
  - **描述：** 将项目文件恢复到执行工具之前的状态。这对于撤消工具所做的文件编辑特别有用。如果在没有工具调用 ID 的情况下运行，它将列出可恢复的可用检查点。
  - **用法：** `/restore [tool_call_id]`
  - **注意：** 仅在使用 `--checkpointing` 选项调用 CLI 或通过[设置](./configuration.md)配置时可用。有关更多详细信息，请参阅[检查点文档](../checkpointing.md)。

- **`/settings`**
  - **描述：** 打开设置编辑器以查看和修改 VeCLI 设置。
  - **详细信息：** 此命令提供用户友好的界面来更改控制 VeCLI 行为和外观的设置。它等同于手动编辑 `.ve/settings.json` 文件，但具有验证和指导以防止错误。
  - **用法：** 只需运行 `/settings`，编辑器就会打开。然后您可以浏览或搜索特定设置，查看其当前值，并根据需要修改它们。某些设置的更改会立即应用，而其他设置需要重新启动。

- **`/stats`**
  - **描述：** 显示当前 VeCLI 会话的详细统计信息，包括令牌使用情况、缓存令牌节省（如果可用）和会话持续时间。注意：缓存令牌信息仅在使用缓存令牌时显示，这在 API 密钥身份验证时发生，但目前在 OAuth 身份验证时不发生。

- [**`/theme`**](./themes.md)
  - **描述：** 打开一个对话框，让您更改 VeCLI 的视觉主题。

- **`/auth`**
  - **描述：** 打开一个对话框，让您更改身份验证方法。

- **`/about`**
  - **描述：** 显示版本信息。提交问题时请分享此信息。

- [**`/tools`**](../tools/index.md)
  - **描述：** 显示 VeCLI 中当前可用的工具列表。
  - **用法：** `/tools [desc]`
  - **子命令：**
    - **`desc`** 或 **`descriptions`**：
      - **描述：** 显示每个工具的详细描述，包括每个工具的名称及其提供给模型的完整描述。
    - **`nodesc`** 或 **`nodescriptions`**：
      - **描述：** 隐藏工具描述，仅显示工具名称。

- **`/privacy`**
  - **描述：** 显示隐私声明并允许用户选择是否同意收集其数据用于服务改进目的。

- **`/quit`**（或 **`/exit`**）
  - **描述：** 退出 VeCLI。

- **`/vim`**
  - **描述：** 打开或关闭 vim 模式。启用 vim 模式时，输入区域在 NORMAL 和 INSERT 模式下都支持 vim 风格的导航和编辑命令。
  - **功能：**
    - **NORMAL 模式：** 使用 `h`、`j`、`k`、`l` 导航；使用 `w`、`b`、`e` 按单词跳转；使用 `0`、`$`、`^` 转到行首/行尾；使用 `G`（或 `gg` 转到第一行）转到特定行
    - **INSERT 模式：** 标准文本输入，按 escape 返回 NORMAL 模式
    - **编辑命令：** 使用 `x` 删除，使用 `c` 更改，使用 `i`、`a`、`o`、`O` 插入；复杂操作如 `dd`、`cc`、`dw`、`cw`
    - **计数支持：** 在命令前加数字（例如，`3h`、`5w`、`10G`）
    - **重复上一个命令：** 使用 `.` 重复上一个编辑操作
    - **持久设置：** Vim 模式首选项保存到 `~/.ve/settings.json` 并在会话之间恢复
  - **状态指示器：** 启用时，在页脚显示 `[NORMAL]` 或 `[INSERT]`

- **`/init`**
  - **描述：** 为了帮助用户轻松创建 `VE.md` 文件，此命令分析当前目录并生成定制的上下文文件，使他们更容易向火山引擎代理提供项目特定的指令。

### 自定义命令

有关快速入门，请参阅下面的[示例](#example-a-pure-function-refactoring-command)。

自定义命令允许您将最喜欢或最常用的提示保存并重用为 VeCLI 中的个人快捷方式。您可以创建特定于单个项目的命令或在所有项目中全局可用的命令，简化您的工作流程并确保一致性。

#### 文件位置和优先级

VeCLI 从两个位置发现命令，按特定顺序加载：

1.  **用户命令（全局）：** 位于 `~/.ve/commands/`。这些命令在您正在处理的任何项目中都可用。
2.  **项目命令（本地）：** 位于 `~/.ve/commands/`。这些命令特定于当前项目，可以检入版本控制以与您的团队共享。

如果项目目录中的命令与用户目录中的命令同名，**项目命令将始终被使用。** 这允许项目使用项目特定版本覆盖全局命令。

#### 命名和命名空间

命令的名称由其相对于其 `commands` 目录的文件路径确定。子目录用于创建命名空间命令，路径分隔符（`/` 或 `\`）被转换为冒号（`:`）。

- `~/.ve/commands/test.toml` 处的文件成为命令 `/test`。
- `<project>/.ve/commands/git/commit.toml` 处的文件成为命名空间命令 `/git:commit`。

#### TOML 文件格式（v1）

您的命令定义文件必须以 TOML 格式编写并使用 `.toml` 文件扩展名。

##### 必需字段

- `prompt`（字符串）：执行命令时将发送给火山引擎模型的提示。这可以是单行或多行字符串。

##### 可选字段

- `description`（字符串）：命令功能的简短、单行描述。此文本将在 `/help` 菜单中显示在您的命令旁边。**如果您省略此字段，将从文件名生成通用描述。**

#### 处理参数

自定义命令支持两种强大的参数处理方法。CLI 根据命令 `prompt` 的内容自动选择正确的方法。

##### 1. 使用 `{{args}}` 的上下文感知注入

如果您的 `prompt` 包含特殊占位符 `{{args}}`，CLI 将用用户在命令名称后键入的文本替换该占位符。

此注入的行为取决于使用位置：

**A. 原始注入（Shell 命令外部）**

在提示的主体中使用时，参数完全按照用户键入的方式注入。

**示例（`git/fix.toml`）：**

```toml
# 通过以下方式调用：/git:fix "按钮未对齐"

description = "为给定问题生成修复。"
prompt = "请为此处描述的问题提供代码修复：{{args}}。"
```

模型接收：`请为此处描述的问题提供代码修复："按钮未对齐"。`

**B. 在 Shell 命令中使用参数（在 `!{...}` 块内）**