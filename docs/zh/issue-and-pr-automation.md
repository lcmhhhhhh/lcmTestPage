# 自动化和分类流程

本文档详细概述了我们用于管理和分类问题和拉取请求的自动化流程。我们的目标是提供及时的反馈，并确保贡献得到高效审查和整合。了解这些自动化将帮助您作为贡献者知道可以期待什么，以及如何最好地与我们的存储库机器人互动。

## 指导原则：问题和拉取请求

首先，几乎每个拉取请求 (PR) 都应该链接到相应的问题。问题描述了“什么”和“为什么”（错误或功能），而 PR 是“如何”（实现）。这种分离有助于我们跟踪工作、确定功能优先级并保持清晰的历史背景。我们的自动化就是围绕这一原则构建的。

---

## 详细的自动化工作流程

以下是我们存储库中运行的特定自动化工作流程的细分。

### 1. 当您打开一个问题时：`自动化问题分类`

这是您创建问题时将互动的第一个机器人。它的工作是执行初步分析并应用正确的标签。

- **工作流程文件**: `.github/workflows/vecli-automated-issue-triage.yml`
- **运行时间**: 在问题创建或重新打开后立即运行。
- **执行内容**:
  - 它使用 Vecli 模型根据详细指南分析问题的标题和正文。
  - **应用一个 `area/*` 标签**: 将问题分类到项目的功能领域（例如，`area/ux`、`area/models`、`area/platform`）。
  - **应用一个 `kind/*` 标签**: 识别问题类型（例如，`kind/bug`、`kind/enhancement`、`kind/question`）。
  - **应用一个 `priority/*` 标签**: 根据描述的影响分配从 P0（关键）到 P3（低）的优先级。
  - **可能应用 `status/need-information`**: 如果问题缺少关键细节（如日志或重现步骤），它将被标记以获取更多信息。
  - **可能应用 `status/need-retesting`**: 如果问题引用的 CLI 版本超过六个版本，则会被标记以在当前版本上重新测试。
- **您应该做什么**:
  - 尽可能完整地填写问题模板。您提供的细节越多，分类就越准确。
  - 如果添加了 `status/need-information` 标签，请在评论中提供所请求的详细信息。

### 2. 当您打开一个拉取请求时：`持续集成 (CI)`

此工作流程确保所有更改在合并之前都符合我们的质量标准。

- **工作流程文件**: `.github/workflows/ci.yml`
- **运行时间**: 在每次推送到拉取请求时。
- **执行内容**:
  - **Lint**: 检查您的代码是否符合我们项目的格式和样式规则。
  - **Test**: 在 macOS、Windows 和 Linux 上以及多个 Node.js 版本上运行我们的全套自动化测试。这是 CI 流程中最耗时的部分。
  - **发布覆盖率评论**: 在所有测试成功通过后，机器人将在您的 PR 上发布评论。此评论提供了您的更改受测试覆盖情况的摘要。
- **您应该做什么**:
  - 确保所有 CI 检查都通过。当一切成功时，您的提交旁边会出现绿色勾号 ✅。
  - 如果检查失败（红色“X”❌），请点击失败检查旁边的“详细信息”链接查看日志，找出问题并推送修复。

### 3. 拉取请求的持续分类：`PR 审核和标签同步`

此工作流程定期运行，以确保所有开放的 PR 都正确链接到问题并具有统一的标签。

- **工作流程文件**: `.github/workflows/vecli-scheduled-pr-triage.yml`
- **运行时间**: 每 15 分钟在所有开放的拉取请求上运行。
- **执行内容**:
  - **检查链接的问题**: 机器人扫描您的 PR 描述以查找链接到问题的关键字（例如，`Fixes #123`、`Closes #456`）。
  - **添加 `status/need-issue`**: 如果未找到链接的问题，机器人将向您的 PR 添加 `status/need-issue` 标签。这是一个明确的信号，表明需要创建并链接一个问题。
  - **同步标签**: 如果链接了问题，机器人会确保 PR 的标签与问题的标签完全匹配。它将添加任何缺失的标签并移除任何不属于的标签，并且如果存在，将移除 `status/need-issue` 标签。
- **您应该做什么**:
  - **始终将您的 PR 链接到一个问题。** 这是最重要的步骤。在您的 PR 描述中添加一行类似于 `Resolves #<issue-number>` 的内容。
  - 这将确保您的 PR 得到正确分类，并顺利通过审查流程。

### 4. 问题的持续分类：`计划问题分类`

这是一个后备工作流程，以确保没有问题被分类流程遗漏。

- **工作流程文件**: `.github/workflows/vecli-scheduled-issue-triage.yml`
- **运行时间**: 每小时在所有开放问题上运行。
- **执行内容**:
  - 它积极寻找完全没有标签或仍有 `status/need-triage` 标签的问题。
  - 然后它会触发与初始分类机器人相同的强大基于 Vecli 的分析，以应用正确的标签。
- **您应该做什么**:
  - 您通常不需要做任何事情。此工作流程是一个安全网，以确保每个问题最终都被分类，即使初始分类失败。

### 5. 发布自动化

此工作流程处理打包和发布 VeCLI 新版本的过程。

- **工作流程文件**: `.github/workflows/release.yml`
- **运行时间**: 每日计划用于“夜间”版本，并手动用于官方补丁/次要版本。
- **执行内容**:
  - 自动构建项目，提升版本号，并将包发布到 npm。
  - 在 GitHub 上创建相应的发布，并生成发布说明。
- **您应该做什么**:
  - 作为贡献者，您无需为此流程做任何事情。您可以确信，一旦您的 PR 合并到 `main` 分支，您的更改将包含在下一个夜间版本中。

我们希望这个详细的概述对您有所帮助。如果您对我们的自动化或流程有任何疑问，请随时提问！